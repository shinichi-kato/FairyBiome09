チャットボットの作り方
====================

# 心のパート

人間は場面や相手によって「頭を切り替えて」返答を考えています。
この切り替えられるひとつひとつを劇における役になぞらえて「パート」と呼ぶことにします。
例えば趣味の話をしている間は「趣味パート」、仕事中は「仕事パート」、店で何かを
買うときは「買い物パート」が返答していて、それらが混ざらないように気をつけます。
さらにパートの切り替わりは気分でも生じ、元気な時は「元気パート」、落ち込んでいる時は
「落ち込んでるパート」が返答をしています。

ここで会話している最中の頭の中を思い出してみると全てのパートは常に並列動作していて、
それらの間でどのパートが表面に現れて会話を担当するのか調整が行われていると思います。

このようなメカニズムにならい、このチャットボットでは一つのキャラクタを複数のパートに
分けてパートごとに返答辞書を設計します。

## パートの設定

パートには以下の設定があります。

|項目|概要|
|---|---|
|返答の方式|知っていることを答える / 知らないことを聞く |
|気力の範囲|気力の値がこの範囲にある場合にパートは返答します。|
|正確さ|0から1の値をとり、辞書にヒットする言葉の正確さを表す|
|持続性|0から1の値を取り、パートが次も発話する確率を示す|


### 返答の方式 kind
**知っていることを答える** 方式では、辞書の入力文字列がユーザのセリフと一致したと
みなした場合それに対応する出力文字列を返答にします。一致しなかった場合は入力文字列
{NOT_FOUND}を探し、あったらそれを返答にします。

**知らないことを聞く** 方式では、辞書の入力文字列がユーザのセリフと一致しなかったと
みなした場合、それについてユーザに質問して返答を受取り、有効な場合は辞書にそれを追加します。

**記憶を再現する** 方式は会話のログを辞書に変換して

### 気力の範囲 momentUpper, momentLower (0〜100)
チャットボットには**気力**(moment)というパラメータがあり、初期は0で会話がうまくつながるほど
大きな値になります。チャットボットの気力が「気力の範囲」内にある場合は辞書に一致するか調べます。
これにより、「挨拶は会話のはじめでしかしない」「趣味の話題は会話が温まってからする」などが
表現できます。

### 正確さ precision (0〜1)
チャットボットはユーザのセリフと辞書の入力文字列の各行を比べ完全に一致したら1、全く一致しなかったら0と
いうスコア計算をします。それがprecisionで示す値を超えた場合「一致した」とみなします。
precisionの値を低くするといい加減な一致でもチャットボットが反応しやすくなり、
precisionの値を高くすると厳密に一致しないとチャットボットが反応しないようになります。

### 持続性 retention (0〜1)
パートが次回も返答を担当するかどうかを決める確率です。この値が高いと話題を引っ張りやすくなり、
0に近いとすぐに話題を終わらせるようになります。

## 基本のパート

チャットボットには以下の状態があり、状態ごとに異なるアバターが表示される。また
各状態と同じ名前のパートがあった場合、他のパートよりも先に評価される。


|状態名| 概要    |
| --- |-------- |
| cheer | 元気、気分が上がっている |
| peace | 平常状態 |
| down | 気分が下がっている |
| sleepy | 眠い |
| sleep | 睡眠中 | 
| absent | 不在 |
| greeting | 挨拶|



